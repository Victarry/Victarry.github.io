= 自建Xray服务器教程
Zhenhuan Liu <nkulzh16@gmail.com>
:sectnums: true

本节介绍了如何搭建xray服务器用于科学上网。

== V2ray和Xray简介
Project V是一个工具集合，可以实现专属的基础通信网络。Project V 的核心工具称为V2Ray，其主要负责网络协议和功能的实现，与其它Project V通信。V2Ray 可以单独运行，也可以和其它工具配合，以提供简便的操作流程。从V2ray上面衍生了各种GUI程序被用于客户端。

2020年，V2ray原作者停止更新 https://github.com/v2fly/v2ray-core[V2Ray]仓库 ，由 https://www.v2fly.org/[V2fly]接管

2020年11月，因为开源许可证等原因XTLS被V2Ray社区从V2ray core移除，VLESS及XTLS的作者和支持者基于V2Ray另行组建了Project X组织。Xray-core 是 v2ray-core 的超集，具有更好的整体性能和 XTLS 等一系列增强，且完全兼容 v2ray-core 的功能及配置。

### 什么是TLS协议

== 服务器配置Xray + https

=== 最简单版本

服务器配置

[source, json]
----
 {
 "log": {
     "access": "/etc/v2ray/access.log",
      "error": "/etc/v2ray/error.log",
      "loglevel": "None"
  },
  "inbounds": [{
    "port": 10086, // 服务器监听端口
    "protocol": "vmess",
    "settings": {
     "clients": [{ "id": "70bb5a14-d4f1-11ed-afa1-0242ac120002", "alterId": 64, "level": 0 }] // id采用UUID格式，可以任意生成
    }
  }],
   "outbounds": [{
     "protocol": "freedom",
     "settings": {}
   }]
}
----

启动服务端命令: xray run --config /etc/v2ray/config_base.json

客户端配置

[source, json]
----
{
  "log": {
    "error": "",
    "loglevel": "info",
    "access": ""
  },
  "inbounds": [
    {
      "listen": "0.0.0.0",
      "protocol": "socks",
      "settings": {
        "udp": false,
        "auth": "noauth"
      },
      "port": "1080"
    },
    {
      "listen": "0.0.0.0",
      "protocol": "http",
      "settings": {
        "timeout": 360
      },
      "port": "1087"
    }
  ],
  "outbounds": [
    {
      "mux": {
        "enabled": false,
        "concurrency": 8
      },
      "protocol": "vmess",
      "streamSettings": {
        "network": "tcp",
        "tcpSettings": {
          "header": {
            "type": "none"
          }
        },
        "security": "none"
      },
      "tag": "proxy",
      "settings": {
        "vnext": [
          {
            "address": "103.195.6.79",
            "users": [
              {
                "id": "70bb5a14-d4f1-11ed-afa1-0242ac120002", // id与服务器保持一致
                "alterId": 64,
                "level": 0,
                "security": "auto"
              }
            ],
            "port": 10086 //与服务器监听端口保持一致
          }
        ]
      }
    },
    {
      "tag": "direct",
      "protocol": "freedom",
      "settings": {
        "domainStrategy": "UseIP",
        "userLevel": 0
      }
    },
    {
      "tag": "block",
      "protocol": "blackhole",
      "settings": {
        "response": {
          "type": "none"
        }
      }
    }
  ],
  "dns": {},
  "routing": {
    "settings": {
      "domainStrategy": "AsIs",
      "rules": []
    }
  },
  "transport": {}
}
----


配置服务

----
[Unit]
Description=Xray Service
Documentation=https://github.com/xtls
After=network.target nss-lookup.target

[Service]
User=root
CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE
AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE
NoNewPrivileges=true
ExecStart=/usr/local/bin/xray run -config /usr/local/etc/xray/config.json
Restart=on-failure
RestartPreventExitStatus=23
LimitNPROC=10000
LimitNOFILE=1000000

[Install]
WantedBy=multi-user.target
----

## 调试相关

- systemctl status查看服务信息
- journalctl -u xray.service -b


== 相关链接
- https://zh.wikipedia.org/wiki/V2Ray#:~:text=V2Ray%EF%BC%8C%E6%98%AFVictoria%20Raymond%E4%BB%A5%E5%8F%8A,%E4%B8%8E%E5%85%B6%E5%AE%83Project%20V%E9%80%9A%E4%BF%A1%E3%80%82[V2ray Wikipedia简介]
- https://github.com/XTLS/Xray-examples[V2ray Examples]
- https://toutyrater.github.io/[V2Ray介绍博客]
- https://xtls.github.io/[Project X]